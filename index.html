<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C2C STOCK SYSTEM</title>

<style>
:root{
  --bg:#111;
  --card:#1b1b1b;
  --text:#fff;
  --accent:#00ff99;
  --danger:#ff4d4d;
}
[data-theme="light"]{
  --bg:#f5f5f5;
  --card:#ffffff;
  --text:#000;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:var(--bg);
  color:var(--text);
}
header{
  padding:15px;
  background:var(--card);
  display:flex;
  justify-content:space-between;
  align-items:center;
  position:sticky;
  top:0;
  z-index:5;
}
button{
  cursor:pointer;
  border:none;
  padding:8px 12px;
  background:var(--accent);
  color:#000;
  font-weight:bold;
  border-radius:4px;
}
button:disabled{opacity:.5}
input{
  padding:6px;
  border-radius:4px;
  border:1px solid #333;
}
#search{
  width:250px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  padding:8px;
  border-bottom:1px solid #333;
  text-align:left;
}
tr:hover{
  background:rgba(255,255,255,0.05);
}
.toast{
  position:fixed;
  bottom:20px;
  right:20px;
  background:var(--accent);
  color:#000;
  padding:10px 15px;
  border-radius:5px;
  display:none;
}
.login{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  z-index:10;
}
</style>
</head>

<body>

<div id="loginScreen" class="login">
  <h2>ENTER ACCESS CODE</h2>
  <input type="password" id="passIn">
  <button onclick="checkAuth()">ENTER</button>
  <div id="err" style="color:red;margin-top:10px;"></div>
</div>

<header>
  <div>
    <button onclick="toggleTheme()">üåô</button>
    <button onclick="clearPhysicalCounts()">CLEAR</button>
    <button id="syncBtn" onclick="syncToCloud()">‚òÅÔ∏è SYNC</button>
  </div>
  <input id="search" placeholder="Search..." oninput="searchData()">
</header>

<table id="table">
  <thead>
    <tr>
      <th>Item</th>
      <th>System</th>
      <th>Physical</th>
      <th>Diff</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div id="toast" class="toast"></div>

<script>
/* =========================
   STATE
========================= */
let db=[];
let physCounts=JSON.parse(localStorage.getItem('c2c_phys_store'))||{};
const CLOUD_API="YOUR_GOOGLE_SCRIPT_URL";

/* =========================
   AUTH
========================= */
function checkAuth(){
  if(document.getElementById('passIn').value==="C2C2026"){
    document.getElementById('loginScreen').style.display="none";
    autoLoad();
  }else{
    document.getElementById('err').innerText="INVALID ACCESS CODE";
  }
}

/* =========================
   LOAD CSV
========================= */
async function autoLoad(){
  try{
    const res=await fetch('data.csv?v='+Date.now());
    const text=await res.text();
    processData(text);
  }catch(e){
    console.error("Load failed");
  }
}

function processData(csv){
  const rows=csv.split('\n').map(r=>r.split(','));
  db=rows.slice(1).map(r=>({
    id:r[0],
    name:r[1],
    systemQty:Number(r[2]||0)
  }));
  render(db);
}

/* =========================
   RENDER
========================= */
function render(data){
  const tbody=document.querySelector('#table tbody');
  tbody.innerHTML="";
  data.slice(0,500).forEach(item=>{
    const phys=physCounts[item.id]?.value||0;
    const diff=phys-item.systemQty;
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${item.name}</td>
      <td>${item.systemQty}</td>
      <td><input type="number" value="${phys}" 
          oninput="updatePhys('${item.id}',this.value)"></td>
      <td style="color:${diff!==0?'var(--danger)':'var(--accent)'}">${diff}</td>
    `;
    tbody.appendChild(tr);
  });
}

/* =========================
   SEARCH
========================= */
function searchData(){
  const q=document.getElementById('search').value.toLowerCase();
  const filtered=db.filter(i=>i.name.toLowerCase().includes(q));
  render(filtered);
}

/* =========================
   UPDATE PHYSICAL
========================= */
function updatePhys(id,val){
  physCounts[id]={value:Number(val)};
  localStorage.setItem('c2c_phys_store',JSON.stringify(physCounts));
  searchData();
}

/* =========================
   SYNC
========================= */
async function syncToCloud(){
  const btn=document.getElementById('syncBtn');
  btn.disabled=true;
  btn.innerText="SYNCING...";

  try{
    await fetch(CLOUD_API,{
      method:"POST",
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(physCounts)
    });
    showToast("SYNCED");
  }catch(e){
    showToast("FAILED");
  }

  btn.disabled=false;
  btn.innerText="‚òÅÔ∏è SYNC";
}

/* =========================
   CLEAR
========================= */
function clearPhysicalCounts(){
  if(confirm("Clear all physical data?")){
    physCounts={};
    localStorage.removeItem('c2c_phys_store');
    render(db);
  }
}

/* =========================
   THEME
========================= */
function toggleTheme(){
  const root=document.documentElement;
  root.setAttribute(
    "data-theme",
    root.getAttribute("data-theme")==="dark"?"light":"dark"
  );
}

/* =========================
   TOAST
========================= */
function showToast(msg){
  const t=document.getElementById('toast');
  t.innerText=msg;
  t.style.display="block";
  setTimeout(()=>t.style.display="none",1500);
}
</script>

</body>
</html>
